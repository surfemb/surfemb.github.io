{"version":3,"sources":["utils.js","KeyViewer.js","DistributionViewer.js","PoseTable.js","App.js","theme.js","index.js"],"names":["loadFloat32Array","url","onload","oReq","XMLHttpRequest","open","responseType","status","Float32Array","response","send","cumulativeOffset","element","top","left","offsetTop","offsetLeft","offsetParent","getRelativeMousePos","e","x","y","round","ne","nativeEvent","touches","pageX","pageY","offset","target","Math","createShader","gl","type","source","shader","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","console","log","getShaderInfoLog","deleteShader","createProgram","vertexShader","fragmentShader","program","attachShader","linkProgram","getProgramParameter","LINK_STATUS","getProgramInfoLog","deleteProgram","KeyViewer","props","state","blend","canvasRef","React","createRef","animationFrameId","R","nj","lastX","lastY","allowRotation","request","prevProps","prevState","snapshot","this","load","window","cancelAnimationFrame","abort","canvas","current","getContext","viewport","width","height","componentWillUnmount","utils","VERTEX_SHADER","FRAGMENT_SHADER","dataBuffer","createBuffer","bindBuffer","ARRAY_BUFFER","vertexCount","urlRoot","data","bufferData","STATIC_DRAW","length","objPosLoc","getAttribLocation","umapPosLoc","colLoc","mLoc","getUniformLocation","blendLoc","lastR","lastBlend","clearColor","clear","COLOR_BUFFER_BIT","glRender","enable","DEPTH_TEST","useProgram","uniform1fv","R_","uniformMatrix4fv","false","reshape","tolist","enableVertexAttribArray","vertexAttribPointer","FLOAT","drawArrays","POINTS","requestAnimationFrame","dx","dR","t","S","sin","C","cos","get_Rx","dot","get_Ry","SVD","u","v","T","style","display","flexDirection","ref","cursor","touchAction","onMouseMove","rotate","onTouchMove","onMouseDown","startRotation","onTouchStart","onMouseLeave","stopRotation","onMouseUp","onTouchEnd","Stack","direction","spacing","sx","mb","alignItems","Slider","orientation","min","max","value","onChange","newBlend","setState","Component","DistributionViewer","embDim","nTextures","textureRange","Array","keys","useRef","imgCanvasCursorRef","queryCanvasCursorRef","canvasCursorRefs","queries","query","max_act","alpha","requests","push","cursorPos","mouseMove","event","l","slice","useEffect","webgl2","getExtension","map","i","join","posBuffer","keyTextures","createTexture","forEach","tex","bindTexture","TEXTURE_2D","texParameteri","TEXTURE_MIN_FILTER","NEAREST","TEXTURE_MAG_FILTER","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","texImage2D","RGB32F","RGB","posLoc","keySamplerLocs","qLocs","aLoc","alphaLoc","ctxs","lastQuery","render","activeTexture","uniform1i","qLoc","uniform3fv","TRIANGLES","ctx","clearRect","beginPath","arc","PI","strokeStyle","stroke","alert","containerStyle","position","borderRadius","overflow","imgStyle","canvasStyle","src","alt","createData","key","method","domain","synth","lmo","tless","tudl","icbin","itodd","hb","ycbv","avg","header","synthRows","rgbdRows","rowToTableRows","rows","row","TableRow","name","TableCell","replace","toLowerCase","DividerRow","colSpan","textAlign","children","PoseTable","TableContainer","component","Paper","Table","size","minWidth","TableHead","TableBody","datasets","d","objIds","ObjectTabs","objIdx","setObjIdx","Tabs","variant","scrollButtons","allowScrollButtonsMobile","newValue","objId","Tab","label","Section","Typography","marginTop","App","datasetIdx","objUrlRoot","ExampleLink","dataset","obj","indexOf","parseInt","Button","padding","color","onClick","Container","maxWidth","Box","my","gutterBottom","fontSize","href","marginBottom","setDatasetIdx","justifyContent","flexWrap","gap","userSelect","theme","createTheme","palette","primary","main","secondary","error","red","A400","ReactDOM","ThemeProvider","CssBaseline","document","querySelector"],"mappings":"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","file":"static/js/main.d435012c.chunk.js","sourcesContent":["export function loadFloat32Array(url, onload) {\n    const oReq = new XMLHttpRequest()\n    oReq.open(\"GET\", url, true)\n    //oReq.setRequestHeader('Cache-Control', 'no-cache') // TODO: remove\n    oReq.responseType = \"arraybuffer\"\n    oReq.onload = () => {\n        if (oReq.status === 200)\n            onload(new Float32Array(oReq.response))\n    }\n    oReq.send(null)\n    return oReq\n}\n\nfunction cumulativeOffset(element) {\n    let top = 0, left = 0\n    do {\n        top += element.offsetTop  || 0\n        left += element.offsetLeft || 0\n        element = element.offsetParent\n    } while(element)\n    return {top, left}\n}\n\nexport function getRelativeMousePos(e, round=false){\n    let x, y\n    const ne = e.nativeEvent\n    if (ne.touches){\n        x = ne.touches[0].pageX\n        y = ne.touches[0].pageY\n    }else{\n        x = ne.pageX\n        y = ne.pageY\n    }\n    const offset = cumulativeOffset(e.target)\n    x = x - offset.left\n    y = y - offset.top\n    if (round){\n        x = Math.round(x)\n        y = Math.round(y)\n    }\n    return {x, y}\n}\n\nexport function createShader(gl, type, source) {\n    const shader = gl.createShader(type);\n    gl.shaderSource(shader, source);\n    gl.compileShader(shader);\n    const success = gl.getShaderParameter(shader, gl.COMPILE_STATUS);\n    if (success) {\n        return shader;\n    }\n\n    console.log(gl.getShaderInfoLog(shader));\n    gl.deleteShader(shader);\n}\n\n\nexport function createProgram(gl, vertexShader, fragmentShader) {\n    const program = gl.createProgram();\n    gl.attachShader(program, vertexShader);\n    gl.attachShader(program, fragmentShader);\n    gl.linkProgram(program);\n    const success = gl.getProgramParameter(program, gl.LINK_STATUS);\n    if (success) {\n        return program;\n    }\n\n    console.log(gl.getProgramInfoLog(program));\n    gl.deleteProgram(program);\n}","import React from 'react';\nimport Slider from '@mui/material/Slider';\nimport Stack from '@mui/material/Stack';\nimport {BubbleChart as UmapIcon} from \"@mui/icons-material\";\nimport {Stop as ObjIcon} from \"@mui/icons-material\";\nimport * as utils from \"./utils\";\n\nimport * as nj from 'numjs';\nimport {SVD} from 'svd-js'\n\nfunction get_Rx(t) {\n    const S = Math.sin(t), C = Math.cos(t)\n    return nj.array([\n        [1, 0, 0],\n        [0, C, -S],\n        [0, S, C]\n    ])\n}\n\nfunction get_Ry(t) {\n    const S = Math.sin(t), C = Math.cos(t)\n    return nj.array([\n        [C, 0, S],\n        [0, 1, 0],\n        [-S, 0, C]\n    ])\n}\n\n\nexport default class KeyViewer extends React.Component {\n    constructor(props) {\n        super(props)\n        this.state = {blend: 0.}\n        this.canvasRef = React.createRef()\n\n        this.animationFrameId = null\n        this.R = nj.identity(3)\n        this.lastX = null\n        this.lastY = null\n        this.allowRotation = false\n        this.gl = null\n        this.request = null\n    }\n\n    componentDidUpdate(prevProps, prevState, snapshot) {\n        if (this.props !== prevProps) this.load()\n    }\n\n    componentWillUnmount() {\n        if (this.animationFrameId !== null)\n            window.cancelAnimationFrame(this.animationFrameId)\n        if (this.request !== null){\n            this.request.abort()\n            this.request = null\n        }\n    }\n\n    componentDidMount() {\n        const canvas = this.canvasRef.current\n        this.gl = canvas.getContext('webgl')\n        this.gl.viewport(0, 0, canvas.width, canvas.height)\n        this.load()\n    }\n\n    load() {\n        this.componentWillUnmount()\n        const gl = this.gl\n        const program = utils.createProgram(gl,\n            utils.createShader(gl, gl.VERTEX_SHADER, `\n                attribute vec4 objPos;\n                attribute vec4 umapPos;\n                attribute vec3 col;\n                varying vec3 colOut;\n                \n                uniform mat4 M;\n                uniform float blend;\n                \n                void main() {\n                    colOut = col;\n                    vec4 pos = ((1.-blend) * objPos + blend * umapPos) * vec4(.95, .95, .95, 1.);\n                    pos = M * pos;\n                    gl_Position = pos * vec4(1., 1., -1., 1.);\n                    gl_PointSize = 2.0;\n                }\n            `),\n            utils.createShader(gl, gl.FRAGMENT_SHADER, `\n                precision mediump float;\n                varying vec3 colOut;\n                void main() {\n                    gl_FragColor = vec4(colOut, 1);\n                }\n            `)\n        )\n\n        const dataBuffer = gl.createBuffer()\n        gl.bindBuffer(gl.ARRAY_BUFFER, dataBuffer)\n        let vertexCount = 0\n\n        this.request = utils.loadFloat32Array(this.props.urlRoot + '-keydata.bin', data => {\n            gl.bufferData(gl.ARRAY_BUFFER, data, gl.STATIC_DRAW)\n            vertexCount = data.length / 9\n        })\n\n        const objPosLoc = gl.getAttribLocation(program, 'objPos')\n        const umapPosLoc = gl.getAttribLocation(program, 'umapPos')\n        const colLoc = gl.getAttribLocation(program, 'col')\n\n        const mLoc = gl.getUniformLocation(program, 'M')\n        const blendLoc = gl.getUniformLocation(program, 'blend')\n\n        let lastR = null, lastBlend = null;\n\n        gl.clearColor(0.0, 0.0, 0.0, 0.0)\n        gl.clear(gl.COLOR_BUFFER_BIT)\n\n        const glRender = () => {\n            if ((lastR !== this.R || lastBlend !== this.state.blend) && vertexCount > 0) {\n                lastBlend = this.state.blend\n                lastR = this.R\n\n                gl.clearColor(0.0, 0.0, 0.0, 0.0)\n                gl.clear(gl.COLOR_BUFFER_BIT)\n                gl.enable(gl.DEPTH_TEST)\n                gl.useProgram(program)\n\n                gl.uniform1fv(blendLoc, [this.state.blend])\n\n                const R_ = nj.concatenate([this.R, nj.zeros([3, 1])])\n                gl.uniformMatrix4fv(mLoc, gl.false, [...R_.reshape(-1).tolist(), 0, 0, 0, 1])\n\n                gl.bindBuffer(gl.ARRAY_BUFFER, dataBuffer)\n\n                gl.enableVertexAttribArray(objPosLoc)\n                gl.vertexAttribPointer(objPosLoc, 3, gl.FLOAT, false, 4 * 9, 0)\n\n                gl.enableVertexAttribArray(umapPosLoc)\n                gl.vertexAttribPointer(umapPosLoc, 3, gl.FLOAT, false, 4 * 9, 4 * 3)\n\n                gl.enableVertexAttribArray(colLoc)\n                gl.vertexAttribPointer(colLoc, 3, gl.FLOAT, false, 4 * 9, 4 * 6)\n\n                gl.drawArrays(gl.POINTS, 0, vertexCount)\n            }\n            this.animationFrameId = window.requestAnimationFrame(glRender)\n        }\n        glRender()\n    }\n\n    rotate(e) {\n        if (this.allowRotation) {\n            const {x, y} = utils.getRelativeMousePos(e)\n            if (this.lastX !== null && this.lastY !== null) {\n                const dx = x - this.lastX, dy = y - this.lastY\n                const s = -1e-2\n                const dR = get_Rx(dy * s).dot(get_Ry(dx * s))\n                let {u, v} = SVD(this.R.dot(dR).tolist())\n                this.R = nj.array(u).dot(nj.array(v).T)\n            }\n            this.lastX = x\n            this.lastY = y\n        }\n    }\n\n    startRotation(e) {\n        this.allowRotation = true\n        const {x, y} = utils.getRelativeMousePos(e)\n        this.lastX = x\n        this.lastY = y\n    }\n\n    stopRotation() {\n        this.allowRotation = false\n        this.lastX = null\n        this.lastY = null\n    }\n\n    render() {\n        return (<div style={{display: 'flex', flexDirection: 'column'}}>\n            <div style={{display: 'flex', flexDirection: 'row'}}>\n                <canvas ref={this.canvasRef} width=\"224\" height=\"224\"\n                        style={{width: 224, cursor: 'move', touchAction: 'none'}}\n                        onMouseMove={e => this.rotate(e)} onTouchMove={e => this.rotate(e)}\n                        onMouseDown={e => this.startRotation(e)} onTouchStart={e => this.startRotation(e)}\n                        onMouseLeave={() => this.stopRotation()} onMouseUp={() => this.stopRotation()}\n                        onTouchEnd={() => this.stopRotation()}\n                />\n                <Stack direction=\"column\" spacing={2} sx={{mb: 1}} alignItems=\"center\" style={{height: 224}}>\n                    <UmapIcon/>\n                    <Slider orientation='vertical' min={0} max={100}\n                            value={this.state.blend * 100}\n                            onChange={(e, newBlend) => this.setState({blend: newBlend / 100})}\n                    />\n                    <ObjIcon/>\n                </Stack>\n            </div>\n        </div>)\n    }\n}","import React, {useRef, useEffect} from 'react';\nimport * as utils from \"./utils\";\n\nexport default function DistributionViewer(props) {\n    const {urlRoot, embDim} = props\n    const nTextures = embDim / 3\n    const textureRange = [...Array(nTextures).keys()]\n\n    const canvasRef = useRef(null)\n    const imgCanvasCursorRef = useRef(null)\n    const queryCanvasCursorRef = useRef(null)\n    const canvasCursorRefs = [imgCanvasCursorRef, queryCanvasCursorRef]\n\n    let queries = null\n    let query = null\n    let max_act = null\n    let alpha = null\n\n    const requests = []\n\n    requests.push(utils.loadFloat32Array(urlRoot + '-queries.bin', data => {\n        queries = data;\n    }))\n\n    let cursorPos = null;\n\n    const mouseMove = event => {\n        let {x, y} = utils.getRelativeMousePos(event)\n        y = Math.min(223, Math.max(0, y))\n        x = Math.min(223, Math.max(0, x))\n        cursorPos = [x, y]\n        if (queries !== null) {\n            const l = (Math.round(y) * 224 + Math.round(x)) * (embDim + 2)\n            query = queries.slice(l, l + embDim)\n            max_act = queries[l + embDim]\n            alpha = queries[l + embDim + 1]\n        }\n    }\n\n    useEffect(() => {\n        const canvas = canvasRef.current\n        // try webgl2\n        let gl = canvas.getContext('webgl2')\n        let webgl2 = true\n        if (gl === null){\n            // try webgl1 with float texture extension\n            webgl2 = false\n            gl = canvas.getContext('webgl')\n            if (gl === null || gl.getExtension('OES_texture_float') === null){\n                // abort\n                window.alert('WebGL2 nor WebGL with float texture extension is supported. Try a different browser.')\n                return\n            }\n        }\n\n        let animationFrameId\n\n        const vertexShader = utils.createShader(gl, gl.VERTEX_SHADER, `${webgl2 ? '#version 300 es' : ''}\n            ${webgl2 ? 'in' : 'attribute'} vec4 pos;\n            ${webgl2 ? 'out' : 'varying'} vec2 vTextureCoord;           \n            void main() {\n                gl_Position = pos;\n                vTextureCoord = pos.xy * vec2(0.5, -0.5) + 0.5;\n            }\n        `)\n\n        const fragmentShader = utils.createShader(gl, gl.FRAGMENT_SHADER, `${webgl2 ? '#version 300 es' : ''}\n            precision mediump float;\n            ${webgl2 ? 'in' : 'varying'} vec2 vTextureCoord;\n            ${textureRange.map(i => 'uniform sampler2D keySampler' + i + ';').join('\\n')}\n            ${textureRange.map(i => 'uniform vec3 q' + i + ';').join('\\n')}\n            uniform float a;\n            uniform float alpha;\n            ${webgl2 ? 'out vec4 outCol;' : ''}\n            void main() {\n                ${textureRange.map(i => 'vec3 k' + i + '=texture' + (webgl2 ? '' : '2D') + '(keySampler' + i + ',vTextureCoord).xyz;').join('\\n')}\n                vec3 dpv = ${textureRange.map(i => 'q' + i + '*k' + i).join('+')};\n                float dp = dpv.x + dpv.y + dpv.z;\n                float v = pow(exp(dp - a), 0.5) * alpha;\n                if (${textureRange.map(i => ['x', 'y', 'z'].map(x => 'k' + i + '.' + x + '==0.').join('&&')).join('&&')})\n                    v = 0.;\n                ${webgl2 ? 'outCol' : 'gl_FragColor'} = vec4(v, 0., 0., v);\n            }\n        `)\n\n        const program = utils.createProgram(gl, vertexShader, fragmentShader);\n\n        const posBuffer = gl.createBuffer()\n        gl.bindBuffer(gl.ARRAY_BUFFER, posBuffer)\n        gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([\n            -1., 1., 1., 1., 1., -1.,\n            -1., 1., 1., -1., -1, -1,\n        ]), gl.STATIC_DRAW)\n        gl.viewport(0, 0, gl.canvas.width, gl.canvas.height)\n\n        const keyTextures = textureRange.map(() => gl.createTexture())\n        keyTextures.forEach((tex, i) => {\n            gl.bindTexture(gl.TEXTURE_2D, tex)\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST)\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST)\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE)\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE)\n            requests.push(utils.loadFloat32Array(urlRoot + '-keys-' + i + '.bin', data => {\n                gl.bindTexture(gl.TEXTURE_2D, tex)\n                gl.texImage2D(gl.TEXTURE_2D, 0, webgl2 ? gl.RGB32F : gl.RGB, 224, 224, 0, gl.RGB, gl.FLOAT, data)\n            }))\n        })\n\n        const posLoc = gl.getAttribLocation(program, 'pos')\n        const keySamplerLocs = textureRange.map(i => gl.getUniformLocation(program, 'keySampler' + i))\n        const qLocs = textureRange.map(i => gl.getUniformLocation(program, 'q' + i))\n        const aLoc = gl.getUniformLocation(program, 'a')\n        const alphaLoc = gl.getUniformLocation(program, 'alpha')\n\n        // cursor\n        const ctxs = canvasCursorRefs.map(ref => ref.current.getContext('2d'))\n\n        let lastQuery = null;\n        gl.clearColor(0.0, 0.0, 0.0, 0.0)\n        gl.clear(gl.COLOR_BUFFER_BIT)\n\n        const render = () => {\n            if (lastQuery !== query) {\n                lastQuery = query\n\n                gl.clearColor(0.0, 0.0, 0.0, 0.0)\n                gl.clear(gl.COLOR_BUFFER_BIT)\n                gl.useProgram(program)\n\n                gl.bindBuffer(gl.ARRAY_BUFFER, posBuffer)\n                gl.enableVertexAttribArray(posLoc)\n                gl.vertexAttribPointer(posLoc, 2, gl.FLOAT, false, 0, 0)\n\n                textureRange.forEach((i) => {\n                    gl.activeTexture(gl['TEXTURE' + i])\n                    gl.bindTexture(gl.TEXTURE_2D, keyTextures[i])\n                    gl.uniform1i(keySamplerLocs[i], i)\n                })\n\n                if (query !== null) {\n                    qLocs.forEach((qLoc, i) => {\n                        gl.uniform3fv(qLoc, query.slice(i * 3, (i + 1) * 3))\n                    })\n                    gl.uniform1fv(aLoc, [max_act])\n                    gl.uniform1fv(alphaLoc, [alpha])\n\n                    gl.drawArrays(gl.TRIANGLES, 0, 6)\n                }\n\n                // cursor\n                //ctx.clearColor(0., 0., 0., 0.)\n                ctxs.forEach(ctx => {\n                    ctx.clearRect(0, 0, 224, 224)\n                    if (query !== null) {\n                        ctx.beginPath()\n                        ctx.arc(...cursorPos, 8, 0, Math.PI * 2)\n                        ctx.strokeStyle = 'white'\n                        ctx.stroke()\n                    }\n                })\n            }\n            animationFrameId = window.requestAnimationFrame(render)\n        };\n        render()\n\n        return () => {\n            window.cancelAnimationFrame(animationFrameId)\n            for (const request of requests) {\n                request.abort()\n            }\n        }\n    })\n\n    const containerStyle = {position: 'relative', width: 224, height: 224, borderRadius: 10, overflow: 'hidden'}\n    const imgStyle = {width: 224, height: 224}\n    const canvasStyle = {\n        width: 224, height: 224, position: 'absolute',\n        left: 0, top: 0, cursor: 'none', touchAction: 'none'\n    }\n\n    return [\n        <div style={containerStyle} key={0}>\n            <img src={urlRoot + '-img.png'} alt=\"input\" style={imgStyle}/>\n            <canvas ref={canvasRef} width=\"224\" height=\"224\" style={canvasStyle}/>\n            <canvas ref={imgCanvasCursorRef} width=\"224\" height=\"224\" style={canvasStyle}\n                    onMouseMove={mouseMove} onTouchMove={mouseMove}\n                    onMouseLeave={() => query = null}\n            />\n        </div>,\n        <div style={containerStyle} key={1}>\n            <img src={urlRoot + '-queryimg.png'} alt=\"queries\" style={imgStyle}/>\n            <canvas ref={queryCanvasCursorRef} width=\"224\" height=\"224\" style={canvasStyle}\n                    onMouseMove={mouseMove} onTouchMove={mouseMove}\n                    onMouseLeave={() => query = null}\n            />\n        </div>\n    ]\n}","import Table from '@mui/material/Table';\nimport TableBody from '@mui/material/TableBody';\nimport TableCell from '@mui/material/TableCell';\nimport TableContainer from '@mui/material/TableContainer';\nimport TableHead from '@mui/material/TableHead';\nimport Paper from '@mui/material/Paper';\nimport {TableRow} from \"@mui/material\";\n\n\nfunction createData(key, method, domain, synth, lmo, tless, tudl, icbin, itodd, hb, ycbv, avg) {\n    return {key, method, domain, synth, lmo, tless, tudl, icbin, itodd, hb, ycbv, avg};\n}\n\nconst header = ['Method', 'Domain', 'Synth', 'LM-O', 'T-LESS', 'TUD-L', 'IC-BIN', 'ITODD', 'HB', 'YCB-V', 'Avg']\nconst synthRows = [\n    createData(-1, <b>SurfEmb</b>, 'RGB', '✓', <b>0.656</b>, <b>0.741</b>, <b>0.715</b>, <b>0.585</b>, <b>0.387</b>,\n        <b>0.793</b>, <b>0.653</b>, <b>0.647</b>),\n    createData(0,'Epos', 'RGB', '✓', 0.547, 0.467, 0.558, 0.363, 0.186, '0.580', 0.499, 0.457),\n    createData(1,'CDPNv2', 'RGB', '✓', 0.624, 0.407, 0.588, 0.473, 0.102, 0.722, '0.390', 0.472),\n    createData(2,'DPODv2', 'RGB', '✓', 0.584, 0.636, '-', '-', '-', 0.725, '-', '-'),\n    createData(3,'PVNet', 'RGB', '✓', 0.575, '-', '-', '-', '-', '-', '-', '-'),\n    createData(4,'CosyPose', 'RGB', '✓', 0.633, '0.640', 0.685, 0.583, 0.216, 0.656, 0.574, '0.570'),\n]\n\nconst rgbdRows = [\n    createData(5,<b>SurfEmb</b>, 'RGB-D', '✓', <b>0.758</b>, <b>0.828</b>, 0.854, <b>0.656</b>, 0.498,\n        <b>0.867</b>, 0.806, <b>0.752</b>),\n    createData(6,<b>SurfEmb</b>, 'RGB-D', '✗', <b>0.758</b>, <b>0.833</b>, 0.933, <b>0.656</b>, 0.498,\n        <b>0.867</b>, 0.824, <b>0.767</b>),\n    createData(7,'Drost', 'RGB-D', '*', 0.515, '0.500', 0.851, 0.368, <b>0.570</b>, 0.671, 0.375, '0.550'),\n    createData(8,'Vidal Sensors', 'D', '*', 0.582, 0.538, 0.876, 0.393, 0.435, 0.706, '0.450', 0.569),\n    createData(9,'Koenig-Hybrid', 'RGB-D', '✗', 0.631, 0.655, '0.920', '0.430', 0.483, 0.651, 0.701, 0.639),\n    createData(10,'Pix2Pose', 'RGB-D', '✗', 0.588, 0.512, '0.820', '0.390', 0.351, 0.695, '0.780', 0.591),\n    createData(11,'CosyPose', 'RGB-D', '✗', 0.714, 0.701, <b>0.939</b>, 0.647, 0.313, 0.712, <b>0.861</b>, 0.698),\n]\n\nconst rowToTableRows = rows => rows.map(row => (\n    <TableRow key={row.key}>\n        {header.map(name =>\n            <TableCell key={row.key + name}>\n                {row[name.replace('-', '').toLowerCase()]}\n            </TableCell>)}\n    </TableRow>\n))\n\nconst DividerRow = props => <TableRow>\n    <TableCell colSpan={11} style={{textAlign: 'center'}}><i>{props.children}</i></TableCell>\n</TableRow>\n\nexport default function PoseTable() {\n    return (\n        <TableContainer component={Paper}>\n            <Table size=\"small\" sx={{minWidth: 852}}>\n                <TableHead>\n                    <TableRow>\n                        {header.map(name => <TableCell key={name}>{name}</TableCell>)}\n                    </TableRow>\n                </TableHead>\n                <TableBody>\n                    <DividerRow>Methods using color, trained purely on synthetic images</DividerRow>\n                    {rowToTableRows(synthRows)}\n                    <DividerRow>Methods using depth</DividerRow>\n                    {rowToTableRows(rgbdRows)}\n                </TableBody>\n            </Table>\n        </TableContainer>\n    )\n}","import * as React from 'react';\nimport Container from '@mui/material/Container';\nimport Typography from '@mui/material/Typography';\nimport Box from '@mui/material/Box';\nimport Tabs from '@mui/material/Tabs';\nimport Tab from '@mui/material/Tab';\nimport Button from '@mui/material/Button';\nimport KeyViewer from \"./KeyViewer\";\nimport DistributionViewer from \"./DistributionViewer\";\nimport PoseTable from \"./PoseTable\";\nimport \"./App.css\";\n\nconst embDim = 12\nconst urlRoot = '/data' + embDim + '/'\n\n\nconst datasets_display = [\n    \"LM-O\",\n    \"T-LESS\",\n    \"TUD-L\",\n    \"IC-BIN\",\n    \"ITODD\",\n    \"HB\",\n    \"YCB-V\"\n]\nconst datasets = datasets_display.map(d => d.replace('-', '').toLowerCase())\n\n\nconst objIds = [\n    [1, 5, 6, 8, 9, 10, 11, 12],\n    [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30],\n    [1, 2, 3],\n    [1, 2],\n    [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28],\n    [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33],\n    [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21]\n]\n\nfunction ObjectTabs(props) {\n    const {objIdx, setObjIdx, objIds} = props;\n    return (\n        <Tabs variant='scrollable' scrollButtons allowScrollButtonsMobile value={objIdx}\n              onChange={(event, newValue) => setObjIdx(newValue)}>\n            {objIds.map((objId, i) =>\n                <Tab key={i} label={objId}/>\n            )}\n        </Tabs>\n    );\n}\n\nfunction Section(props) {\n    return (<Typography variant=\"h6\" style={{marginTop: '1.5em'}}>{props.children}</Typography>)\n}\n\n\nexport default function App() {\n    const [{datasetIdx, objIdx}, setState] = React.useState({datasetIdx: 1, objIdx: 1})\n\n    const setDatasetIdx = datasetIdx => setState({datasetIdx, objIdx: 0})\n    const setObjIdx = objIdx => setState({datasetIdx, objIdx})\n\n    const dataset = datasets[datasetIdx]\n    const objUrlRoot = urlRoot + dataset + '-' + objIdx\n\n    const ExampleLink = props => {\n        let {dataset, obj} = props\n        if (typeof dataset === 'string') dataset = datasets.indexOf(dataset)\n        if (typeof obj === 'string') obj = objIds[dataset].indexOf(parseInt(obj))\n        return (\n            <span>\n                <span> </span>\n                <Button style={{padding: 0, minWidth: 0, color: '#143b96'}} onClick={() => setState({\n                    datasetIdx: dataset, objIdx: obj\n                })}>\n                    {datasets[dataset]} {objIds[dataset][obj]}\n                </Button>\n            </span>\n        )\n    }\n\n    return (\n        <Container style={{maxWidth: 900}}>\n            <Box sx={{my: 4}}>\n                <Typography variant=\"h4\" component=\"h1\" gutterBottom textAlign='center'>\n                    SurfEmb\n                </Typography>\n                <Typography textAlign='center' fontSize={18}>\n                    Dense and Continuous Correspondence Distributions <br/>\n                    for Object Pose Estimation with Learnt Surface Embeddings\n                </Typography>\n            </Box>\n            <Typography textAlign='center'>\n                Rasmus Laurvig Haugaard, Anders Glent Buch\n            </Typography>\n            <Typography textAlign='center'>\n                SDU Robotics, University of Southern Denmark\n            </Typography>\n            <Typography textAlign='center'>\n                CVPR 2022<span> | </span>\n                <a href=\"https://github.com/rasmushaugaard/surfemb\">CODE</a><span> | </span>\n                <a href=\"https://arxiv.org/abs/2111.13489\">PDF</a>\n            </Typography>\n            <Section>Abstract</Section>\n            <p>\n                We present an approach to learn dense, continuous 2D-3D correspondence distributions over the surface\n                of objects from data with no prior knowledge of visual ambiguities like symmetry. We also present a\n                new method for 6D pose estimation of rigid objects using the learnt distributions to sample,\n                score and refine pose hypotheses.\n                The correspondence distributions are learnt with a contrastive loss, represented in object-specific\n                latent spaces by an encoder-decoder query model and a small fully connected key model.\n                Our method is unsupervised with respect to visual ambiguities, yet we show that the query- and key\n                models learn to represent accurate multi-modal surface distributions.\n                Our pose estimation method improves the state-of-the-art significantly on the comprehensive BOP\n                Challenge, trained purely on synthetic data, even compared with methods trained on real data.\n            </p>\n            <Section>Estimated Correspondence Distributions</Section>\n            <p>\n                Hover over the input image (left) or query image (middle) to see the estimated correspondence\n                distribution.\n                Drag the keys (right) to rotate them, or drag the slider to interpolate between keys'\n                object coordinates and UMAP projection.\n            </p>\n            <p>\n                Interesting examples include discrete rotational symmetry:\n                <ExampleLink dataset=\"tless\" obj=\"2\"/>,\n                <ExampleLink dataset=\"tless\" obj=\"27\"/>,\n                <ExampleLink dataset=\"tless\" obj=\"23\"/>,\n                <ExampleLink dataset=\"itodd\" obj=\"7\"/>,\n                <span> </span>full rotational symmetry:\n                <ExampleLink dataset=\"tless\" obj=\"14\"/>,\n                <ExampleLink dataset=\"tless\" obj=\"15\"/>,\n                <ExampleLink dataset=\"tless\" obj=\"17\"/>,\n                <span> </span>and no symmetry:\n                <ExampleLink dataset=\"tless\" obj=\"7\"/>,\n                <ExampleLink dataset=\"tless\" obj=\"25\"/>,\n                <ExampleLink dataset=\"lmo\" obj=\"8\"/>,\n                <ExampleLink dataset=\"tudl\" obj=\"1\"/>,\n                <ExampleLink dataset=\"icbin\" obj=\"1\"/>,\n                <ExampleLink dataset=\"hb\" obj=\"1\"/>,\n                <ExampleLink dataset=\"ycbv\" obj=\"1\"/>.\n            </p>\n            <Box sx={{width: '100%', marginBottom: 2}}>\n                <Box>\n                    <Tabs variant='scrollable' scrollButtons allowScrollButtonsMobile value={datasetIdx}\n                          onChange={(event, newValue) => {\n                              setDatasetIdx(newValue);\n                              console.log(newValue)\n                          }}>\n                        {datasets.map((dataset, i) =>\n                            <Tab key={i} label={dataset}/>\n                        )}\n                    </Tabs>\n                    <ObjectTabs objIds={objIds[datasetIdx]} objIdx={objIdx} setObjIdx={setObjIdx}/>\n                </Box>\n            </Box>\n            <Box>\n                <div style={{\n                    display: 'flex', flexDirection: 'row', justifyContent: 'center',\n                    flexWrap: 'wrap', gap: 20, userSelect: 'none'\n                }}>\n                    <DistributionViewer embDim={embDim} urlRoot={objUrlRoot}/>\n                    <KeyViewer key={2} urlRoot={objUrlRoot}/>\n                </div>\n            </Box>\n            <p>\n                The UMAP projection of keys shows the key manifold and primarily\n                provides insight to constant ambiguities, like global symmetry.\n                A query can also represent view-dependent ambiguities which is best seen by exploring the distributions.\n            </p>\n            <p>\n                Examples are chosen randomly for each object in the seven BOP Challenge datasets.\n                Models are trained purely on synthetic images and shown on real images\n                except for ITODD and HB, shown on synthetic images, because ground truth poses are not\n                publicly available on the real images.\n            </p>\n            <p>\n                Distributions may appear worse than they are because of poor ground truth poses:\n                <ExampleLink dataset=\"lmo\" obj=\"1\"/> (see the distributions near the edges), or poor meshes:\n                <ExampleLink dataset=\"tudl\" obj=\"1\"/>.\n            </p>\n            <Section>Pose Estimation</Section>\n            <p> We use the distributions to sample, score and refine pose hypotheses.\n                Our pose estimation method is trained and evaluated on the seven BOP Challenge datasets:</p>\n            <PoseTable/>\n            <p>\n                Synth: Method is trained purely on synthetic images.\n                Note that only T-LESS, TUD-L and YCBV provide real images for training.\n                * Methods do not use the available training data.\n            </p>\n            <p>&nbsp;</p>\n        </Container>\n    );\n}","import { red } from '@mui/material/colors';\nimport { createTheme } from '@mui/material/styles';\n\n// A custom theme for this app\nconst theme = createTheme({\n  palette: {\n    primary: {\n      main: '#556cd6',\n    },\n    secondary: {\n      main: '#19857b',\n    },\n    error: {\n      main: red.A400,\n    },\n  },\n});\n\nexport default theme;","import * as React from 'react';\nimport ReactDOM from 'react-dom';\nimport CssBaseline from '@mui/material/CssBaseline';\nimport { ThemeProvider } from '@mui/material/styles';\nimport App from './App';\nimport theme from './theme';\n\nReactDOM.render(\n  <ThemeProvider theme={theme}>\n    {/* CssBaseline kickstart an elegant, consistent, and simple baseline to build upon. */}\n    <CssBaseline />\n    <App />\n  </ThemeProvider>,\n  document.querySelector('#root'),\n);"],"sourceRoot":""}